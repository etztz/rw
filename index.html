<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="browser-startpage" content="true">
    <title>每日任务 | 浏览器起始页（优化版）</title>
    <style>
        :root {
            --primary-color: #4ECDC4;
            --primary-dark: #3DBBB4;
            --secondary-color: #FF6B6B;
            --success-color: #68D391;
            --warning-color: #FFD166;
            --text-primary: #2D3748;
            --text-secondary: #718096;
            --text-light: #A0AEC0;
            --bg-light: #F7FAFC;
            --bg-white: #FFFFFF;
            --shadow: 0 4px 20px rgba(78, 205, 196, 0.1);
            --shadow-heavy: 0 8px 30px rgba(78, 205, 196, 0.15);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', 'PingFang SC', sans-serif;
        }

        body {
            min-height: 100vh;
            padding: 20px 10px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, 
                #f0f9ff 0%, 
                #e6f7f5 25%, 
                #f5faff 50%, 
                #fff5f5 75%, 
                #f0f9ff 100%);
            background-size: 400% 400%;
            animation: gradientAnim 20s ease infinite;
            transition: var(--transition);
            background-attachment: fixed;
            background-repeat: no-repeat;
            background-position: center;
            overflow-x: hidden;
        }

        body.custom-bg {
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            animation: none !important;
        }

        body.custom-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(3px);
            z-index: -1;
        }

        @keyframes gradientAnim {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* 背景设置面板 */
        .bg-settings-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%;
            max-width: 500px;
            background: white;
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow-heavy);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .bg-settings-panel.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            pointer-events: all;
        }

        .bg-preview {
            width: 100%;
            height: 150px;
            border-radius: var(--radius-sm);
            margin: 16px 0;
            background-size: cover;
            background-position: center;
            border: 2px dashed #E2E8F0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            overflow: hidden;
        }

        .bg-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .bg-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 16px 0;
        }

        .bg-option {
            height: 60px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
            overflow: hidden;
            position: relative;
        }

        .bg-option:hover {
            transform: scale(1.05);
        }

        .bg-option.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.2);
        }

        .bg-option .bg-thumb {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
        }

        .bg-option.color {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* 搜索栏容器 */
        .search-container {
            width: 100%;
            max-width: 650px;
            margin: 0 auto 30px;
            position: relative;
            z-index: 10;
        }

        .search-box {
            background: var(--bg-white);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(78, 205, 196, 0.1);
            backdrop-filter: blur(10px);
            transition: var(--transition);
            position: relative;
        }

        .search-box:hover {
            box-shadow: var(--shadow-heavy);
        }

        /* 拖拽手柄 */
        .drag-handle {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            cursor: move;
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(78, 205, 196, 0.2);
            transition: var(--transition);
            z-index: 5;
            user-select: none;
        }

        .drag-handle:hover {
            color: var(--primary-color);
            background: rgba(78, 205, 196, 0.1);
            border-color: var(--primary-color);
        }

        .drag-handle-corner {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: move;
            color: var(--text-light);
            padding: 5px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(5px);
            z-index: 5;
            transition: var(--transition);
        }

        .drag-handle-corner:hover {
            color: var(--primary-color);
            background: rgba(78, 205, 196, 0.1);
        }

        /* 拖拽相关样式 */
        .draggable {
            position: relative;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .draggable.dragging {
            z-index: 1000 !important;
            opacity: 0.95;
            box-shadow: 0 15px 50px rgba(78, 205, 196, 0.4) !important;
            transform: scale(1.01);
            cursor: grabbing !important;
        }

        /* 边界限制样式 */
        .boundary-limit {
            box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.3) !important;
            animation: boundaryShake 0.5s ease;
        }

        @keyframes boundaryShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .search-engine-selector {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #F1F5F9;
        }

        .search-engine-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .search-engine-options {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .search-engine-option {
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 6px;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .search-engine-option:hover {
            background: #F1F5F9;
        }

        .search-engine-option.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-dark);
        }

        .search-engine-option i {
            font-size: 16px;
        }

        /* 搜索输入框 */
        .search-input-container {
            position: relative;
            margin-bottom: 12px;
        }

        .search-input {
            width: 100%;
            padding: 16px 24px 16px 52px;
            border: 2px solid #E2E8F0;
            border-radius: var(--radius);
            font-size: 16px;
            transition: var(--transition);
            background: var(--bg-light);
            color: var(--text-primary);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.15);
            background: white;
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            font-size: 20px;
        }

        .search-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.3);
        }

        /* 顶部工具栏 */
        .top-toolbar {
            width: 100%;
            max-width: 650px;
            margin: 0 auto 20px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            flex-wrap: wrap;
            position: relative;
            z-index: 20;
        }

        .tool-btn {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(78, 205, 196, 0.2);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            backdrop-filter: blur(5px);
        }

        .tool-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        /* 名言展示区 */
        .quote-container {
            width: 100%;
            max-width: 650px;
            margin: 0 auto 30px;
            position: relative;
            z-index: 10;
        }

        .quote-box {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 249, 255, 0.95));
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .quote-box::before {
            content: '"';
            position: absolute;
            top: -20px;
            left: 20px;
            font-size: 120px;
            color: rgba(78, 205, 196, 0.1);
            font-family: serif;
            line-height: 1;
        }

        .quote-content {
            font-size: 18px;
            line-height: 1.6;
            color: var(--text-primary);
            font-style: italic;
            margin-bottom: 16px;
            padding-left: 20px;
            border-left: 3px solid var(--primary-color);
        }

        .quote-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .quote-source {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quote-controls {
            display: flex;
            gap: 10px;
        }

        .quote-control-btn {
            background: transparent;
            border: 1px solid #E2E8F0;
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .quote-control-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* 积分统计系统 - 简化版 */
        .score-panel {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 251, 235, 0.95));
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 214, 102, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #FFD166;
        }

        .score-title {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-primary);
            font-size: 20px;
            font-weight: 600;
        }

        .score-display {
            background: linear-gradient(135deg, #FFD166, #FBBF24);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(255, 209, 102, 0.3);
        }

        .score-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .score-stat-item {
            background: white;
            border-radius: var(--radius-sm);
            padding: 16px;
            border: 1px solid #E2E8F0;
            transition: var(--transition);
        }

        .score-stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .score-stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .score-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .score-stat-value.positive {
            color: #68D391;
        }

        .score-stat-value.negative {
            color: #FF6B6B;
        }

        /* 简化的积分输入 */
        .score-input-section {
            background: #F8FAFC;
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-top: 20px;
        }

        .score-input-title {
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .activity-input-container {
            margin-bottom: 16px;
        }

        .activity-input {
            width: 100%;
            padding: 14px;
            border: 2px solid #E2E8F0;
            border-radius: var(--radius-sm);
            font-size: 14px;
            transition: var(--transition);
            background: white;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        .activity-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.15);
        }

        .score-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .score-suggestions {
            margin-top: 16px;
        }

        .suggestions-title {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
        }

        .suggestion-btn {
            padding: 8px 12px;
            background: white;
            border: 1px solid #E2E8F0;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .suggestion-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* 任务面板透明度 */
        .task-panel-transparency {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: var(--radius-sm);
            margin-bottom: 16px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 10;
        }

        .transparency-label {
            font-size: 14px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
        }

        .transparency-slider {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            background: linear-gradient(to right, rgba(78, 205, 196, 0.2), var(--primary-color));
            border-radius: 3px;
            outline: none;
        }

        .transparency-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(78, 205, 196, 0.4);
            transition: var(--transition);
        }

        .transparency-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .transparency-value {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
            min-width: 40px;
            text-align: center;
        }

        /* 主容器 */
        .container {
            width: 100%;
            max-width: 650px;
            position: relative;
            z-index: 10;
        }

        /* 面板样式 */
        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: var(--transition);
            position: relative;
        }

        .panel:hover {
            box-shadow: var(--shadow-heavy);
        }

        .panel-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(78, 205, 196, 0.2);
            user-select: none;
        }

        /* 用户状态面板 */
        .status-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }

        .status-item {
            text-align: center;
            padding: 20px 16px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: var(--radius-sm);
            border: 1px solid rgba(226, 232, 240, 0.5);
            transition: var(--transition);
        }

        .status-item:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .status-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .status-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 12px;
        }

        .exp-bar-container {
            width: 100%;
            height: 8px;
            background: #E2E8F0;
            border-radius: 4px;
            overflow: hidden;
        }

        .exp-bar {
            height: 100%;
            background: linear-gradient(90deg, #4ECDC4, #68D391);
            width: 0%;
            transition: width 0.8s ease;
        }

        /* 任务添加表单 */
        .add-task-section {
            margin-bottom: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 12px;
            align-items: center;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E2E8F0;
            border-radius: var(--radius-sm);
            font-size: 14px;
            transition: var(--transition);
            background: white;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.15);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* 任务列表样式 */
        .task-list {
            min-height: 100px;
            transition: var(--transition);
        }

        .task-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: var(--transition);
            cursor: grab;
            user-select: none;
            position: relative;
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-color: var(--primary-color);
        }

        .task-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .task-item.drag-over {
            border: 2px dashed var(--primary-color);
            background: rgba(78, 205, 196, 0.05);
        }

        .task-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .task-drag-handle {
            cursor: grab;
            color: var(--text-light);
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .task-drag-handle:hover {
            color: var(--primary-color);
        }

        .task-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--success-color);
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .task-title.completed {
            text-decoration: line-through;
            color: var(--text-light);
        }

        .task-notes {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 8px;
            padding: 8px;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 4px;
            border-left: 3px solid var(--primary-color);
        }

        .task-meta {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .task-category,
        .task-date,
        .task-points {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 500;
        }

        .task-category {
            background: rgba(78, 205, 196, 0.1);
            color: var(--primary-color);
        }

        .task-date {
            background: rgba(160, 174, 192, 0.1);
            color: var(--text-secondary);
        }

        .task-points {
            background: rgba(104, 211, 145, 0.1);
            color: var(--success-color);
        }

        .task-links {
            margin-top: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .task-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(78, 205, 196, 0.1);
            color: var(--primary-color);
            text-decoration: none;
            border-radius: 6px;
            font-size: 12px;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .task-link:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(78, 205, 196, 0.3);
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 16px;
        }

        /* 按钮统一样式 */
        .btn {
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #68D391, #48BB78);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #48BB78, #38A169);
            box-shadow: 0 4px 12px rgba(104, 211, 145, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #FFD166, #FBBF24);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #FBBF24, #F59E0B);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #FF6B6B, #E53E3E);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #E53E3E, #C53030);
            box-shadow: 0 4px 12px rgba(229, 62, 62, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #CBD5E0, #A0AEC0);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #A0AEC0, #718096);
            box-shadow: 0 4px 12px rgba(160, 174, 192, 0.3);
        }

        /* 模态框样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            padding: 24px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #E2E8F0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--text-primary);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
        }

        /* 名言管理面板 */
        .quotes-manager-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%;
            max-width: 600px;
            background: white;
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow-heavy);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .quotes-manager-panel.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            pointer-events: all;
        }

        .quotes-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            border: 1px solid #E2E8F0;
            border-radius: var(--radius-sm);
            padding: 12px;
        }

        .quote-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 12px;
            border-bottom: 1px solid #F1F5F9;
            transition: var(--transition);
        }

        .quote-item:last-child {
            border-bottom: none;
        }

        .quote-item:hover {
            background: #F8FAFC;
            border-radius: 6px;
        }

        .quote-item-content {
            flex: 1;
            margin-right: 20px;
        }

        .quote-item-text {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .quote-item-source {
            font-size: 12px;
            color: var(--text-secondary);
            font-style: italic;
        }

        .quote-item-actions {
            display: flex;
            gap: 8px;
        }

        /* 任务详情模态框 */
        .task-detail-modal .form-group {
            margin-bottom: 16px;
        }

        .links-container {
            margin-top: 16px;
        }

        .link-item {
            display: grid;
            grid-template-columns: 1fr 2fr auto;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: #F8FAFC;
            border-radius: var(--radius-sm);
        }

        .add-link-btn {
            margin-top: 10px;
        }

        /* 布局保存按钮 */
        .save-layout-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.4);
            transition: var(--transition);
        }

        .save-layout-btn:hover {
            transform: scale(1.1);
            background: var(--primary-dark);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .search-engine-selector {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .search-engine-options {
                width: 100%;
                justify-content: space-between;
            }
            
            .score-stats {
                grid-template-columns: 1fr;
            }
            
            .panel {
                padding: 20px 16px;
            }
            
            .panel-title {
                font-size: 18px;
            }
            
            .quote-content {
                font-size: 16px;
            }
            
            .score-display {
                font-size: 20px;
                padding: 6px 16px;
            }

            .bg-options {
                grid-template-columns: repeat(2, 1fr);
            }

            .link-item {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .suggestions-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .top-toolbar {
                justify-content: center;
            }

            .tool-btn span {
                display: none;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px 5px;
            }
            
            .search-box,
            .quote-box,
            .panel {
                padding: 16px 12px;
            }
            
            .search-input {
                padding: 14px 20px 14px 48px;
                font-size: 15px;
            }
            
            .search-icon {
                left: 16px;
            }
            
            .quote-content {
                font-size: 15px;
                padding-left: 12px;
            }
            
            .quote-controls {
                flex-direction: column;
                width: 100%;
            }
            
            .quote-control-btn {
                width: 100%;
                justify-content: center;
            }

            .task-header {
                flex-direction: column;
                gap: 12px;
            }

            .task-actions {
                align-self: flex-end;
            }

            .drag-handle {
                width: 25px;
                height: 25px;
                font-size: 12px;
            }
        }

        /* 动画效果 */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .panel {
            animation: slideIn 0.5s ease-out;
        }

        .task-item {
            animation: slideIn 0.3s ease-out;
        }

        /* 滚动条美化 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #F1F5F9;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* 工具类 */
        .hidden {
            display: none !important;
        }

        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .space-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .text-success {
            color: #68D391 !important;
        }

        .text-danger {
            color: #FF6B6B !important;
        }

        .text-warning {
            color: #FFD166 !important;
        }

        .text-primary {
            color: var(--primary-color) !important;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- 顶部工具栏 -->
    <div class="top-toolbar">
        <button class="tool-btn" id="bgSettingsBtn">
            <i class="fas fa-image"></i>
            <span>背景设置</span>
        </button>
        <button class="tool-btn" id="exportDataBtn">
            <i class="fas fa-download"></i>
            <span>导出数据</span>
        </button>
        <button class="tool-btn" id="importDataBtn">
            <i class="fas fa-upload"></i>
            <span>导入数据</span>
        </button>
        <button class="tool-btn" id="resetAllBtn">
            <i class="fas fa-redo"></i>
            <span>重置所有</span>
        </button>
    </div>

    <!-- 搜索栏 -->
    <div class="search-container" id="searchContainer">
        <div class="search-box draggable" id="searchBox">
            <div class="drag-handle" title="拖拽移动">
                <i class="fas fa-arrows-alt"></i>
            </div>
            <div class="search-engine-selector">
                <div class="search-engine-label">搜索引擎：</div>
                <div class="search-engine-options" id="searchEngineOptions">
                    <div class="search-engine-option selected" data-engine="bing">
                        <i class="fab fa-microsoft"></i> Bing
                    </div>
                    <div class="search-engine-option" data-engine="google">
                        <i class="fab fa-google"></i> Google
                    </div>
                    <div class="search-engine-option" data-engine="baidu">
                        <i class="fab fa-baidu"></i> 百度
                    </div>
                    <div class="search-engine-option" data-engine="github">
                        <i class="fab fa-github"></i> GitHub
                    </div>
                </div>
            </div>
            <form id="searchForm" action="https://www.bing.com/search" method="GET" target="_blank">
                <div class="search-input-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" 
                           class="search-input" 
                           id="searchInput" 
                           name="q" 
                           placeholder="在Bing中搜索..." 
                           autocomplete="off"
                           required>
                </div>
                <button type="submit" class="search-btn">
                    <i class="fas fa-search"></i> 搜索
                </button>
            </form>
        </div>
    </div>

    <!-- 名言展示区 -->
    <div class="quote-container" id="quoteContainer">
        <div class="quote-box draggable" id="quoteBox">
            <div class="drag-handle" title="拖拽移动">
                <i class="fas fa-arrows-alt"></i>
            </div>
            <div class="quote-content" id="currentQuote">
                生活就像一盒巧克力，你永远不知道下一颗是什么味道。——《阿甘正传》
            </div>
            <div class="quote-meta">
                <div class="quote-source">
                    <i class="fas fa-quote-left"></i>
                    <span id="quoteAuthor">《阿甘正传》</span>
                </div>
                <div class="quote-controls">
                    <button class="quote-control-btn" id="prevQuoteBtn">
                        <i class="fas fa-chevron-left"></i> 上一个
                    </button>
                    <button class="quote-control-btn" id="nextQuoteBtn">
                        下一个 <i class="fas fa-chevron-right"></i>
                    </button>
                    <button class="quote-control-btn" id="manageQuotesBtn">
                        <i class="fas fa-cog"></i> 管理
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 积分统计面板 - 简化版 -->
    <div class="score-panel draggable" id="scorePanel">
        <div class="drag-handle" title="拖拽移动">
            <i class="fas fa-arrows-alt"></i>
        </div>
        <div class="score-header">
            <div class="score-title">
                <i class="fas fa-chart-line"></i>
                <span>今日积分统计</span>
            </div>
            <div class="score-display" id="totalScore">0 分</div>
        </div>
        
        <div class="score-stats">
            <div class="score-stat-item">
                <div class="score-stat-label">
                    <i class="fas fa-plus-circle text-success"></i>
                    今日加分
                </div>
                <div class="score-stat-value positive" id="todayPositive">0 分</div>
            </div>
            <div class="score-stat-item">
                <div class="score-stat-label">
                    <i class="fas fa-minus-circle text-danger"></i>
                    今日扣分
                </div>
                <div class="score-stat-value negative" id="todayNegative">0 分</div>
            </div>
            <div class="score-stat-item">
                <div class="score-stat-label">
                    <i class="fas fa-tasks text-primary"></i>
                    完成任务
                </div>
                <div class="score-stat-value" id="completedTasksScore">0 个</div>
            </div>
            <div class="score-stat-item">
                <div class="score-stat-label">
                    <i class="fas fa-star text-warning"></i>
                    累计积分
                </div>
                <div class="score-stat-value" id="totalAccumulated">0 分</div>
            </div>
        </div>

        <!-- 简化的积分输入 -->
        <div class="score-input-section">
            <div class="score-input-title">
                <i class="fas fa-plus-circle"></i>
                <span>快速添加今日活动</span>
            </div>
            
            <div class="activity-input-container">
                <input type="text" 
                       class="activity-input" 
                       id="activityInput" 
                       placeholder="输入你做了什么，例如：跑步30分钟、完成工作报告..."
                       autocomplete="off">
            </div>
            
            <div class="score-actions">
                <button class="btn btn-primary" id="addActivityBtn">
                    <i class="fas fa-plus"></i> 添加活动
                </button>
                <button class="btn btn-success" id="quickAddTaskBtn">
                    <i class="fas fa-tasks"></i> 转为任务
                </button>
                <button class="btn btn-secondary" id="clearActivitiesBtn">
                    <i class="fas fa-trash"></i> 清空今日
                </button>
            </div>
            
            <div class="score-suggestions">
                <div class="suggestions-title">常用活动：</div>
                <div class="suggestions-grid" id="activitySuggestions">
                    <!-- 建议按钮将通过JS动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 任务面板透明度控制 -->
    <div class="task-panel-transparency draggable" id="transparencyPanel">
        <div class="drag-handle" title="拖拽移动">
            <i class="fas fa-arrows-alt"></i>
        </div>
        <div class="transparency-label">
            <i class="fas fa-adjust"></i>
            <span>面板透明度</span>
        </div>
        <input type="range" 
               class="transparency-slider" 
               id="panelTransparency" 
               min="70" 
               max="100" 
               value="95">
        <div class="transparency-value" id="transparencyValue">95%</div>
    </div>

    <!-- 主容器 -->
    <div class="container">
        <!-- 用户状态面板 -->
        <div class="panel draggable" id="statusPanel">
            <div class="drag-handle" title="拖拽移动">
                <i class="fas fa-arrows-alt"></i>
            </div>
            <h2 class="panel-title">
                <i class="fas fa-user-circle"></i> 我的任务状态
            </h2>
            <div class="status-panel">
                <div class="status-item">
                    <div class="status-label">总任务数</div>
                    <div class="status-value" id="totalTasks">0</div>
                </div>
                <div class="status-item">
                    <div class="status-label">已完成</div>
                    <div class="status-value" id="completedTasks">0</div>
                </div>
                <div class="status-item">
                    <div class="status-label">待完成</div>
                    <div class="status-value" id="pendingTasks">0</div>
                </div>
                <div class="status-item">
                    <div class="status-label">今日积分</div>
                    <div class="status-value" id="todayExp">0</div>
                    <div class="exp-bar-container">
                        <div class="exp-bar" id="expBar"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 任务列表面板 -->
        <div class="panel draggable" id="taskPanel">
            <div class="drag-handle" title="拖拽移动">
                <i class="fas fa-arrows-alt"></i>
            </div>
            <h2 class="panel-title">
                <i class="fas fa-list-alt"></i> 我的任务列表
            </h2>
            
            <!-- 任务添加表单 -->
            <div class="add-task-section">
                <form class="add-task-form" id="addTaskForm">
                    <div class="form-row">
                        <input type="text" 
                               class="form-input" 
                               id="taskTitle" 
                               placeholder="输入任务名称..." 
                               required>
                        <select class="form-select" id="taskCategory" required>
                            <option value="">选择分类</option>
                            <option value="工作">工作</option>
                            <option value="学习">学习</option>
                            <option value="生活">生活</option>
                            <option value="健康">健康</option>
                            <option value="其他">其他</option>
                        </select>
                        <input type="date" class="form-input" id="taskDate" required>
                        <input type="number" 
                               class="form-input" 
                               id="taskPoints" 
                               min="1" 
                               max="10" 
                               value="5" 
                               placeholder="积分">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> 添加
                        </button>
                    </div>
                    <div class="form-group" style="margin-top: 12px;">
                        <textarea class="form-textarea" 
                                  id="taskNotes" 
                                  placeholder="任务备注（可选）..." 
                                  rows="2"></textarea>
                    </div>
                </form>
            </div>

            <!-- 任务列表 -->
            <div class="task-list" id="taskList">
                <!-- 任务项将通过JS动态生成 -->
            </div>
        </div>
    </div>

    <!-- 保存布局按钮 -->
    <button class="save-layout-btn" id="saveLayoutBtn" title="保存当前布局">
        <i class="fas fa-save"></i>
    </button>

    <!-- 背景设置面板 -->
    <div class="bg-settings-panel" id="bgSettingsPanel">
        <div class="modal-header">
            <h3><i class="fas fa-image"></i> 背景设置</h3>
            <button class="close-modal" id="closeBgPanel">&times;</button>
        </div>
        
        <div class="form-group">
            <label>选择背景类型</label>
            <div class="bg-options">
                <div class="bg-option color selected" data-type="gradient" data-bg="gradient1" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    渐变1
                </div>
                <div class="bg-option color" data-type="gradient" data-bg="gradient2" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    渐变2
                </div>
                <div class="bg-option color" data-type="gradient" data-bg="gradient3" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    渐变3
                </div>
                <div class="bg-option color" data-type="color" data-bg="#f8fafc" style="background: #f8fafc; color: #64748b;">
                    浅色
                </div>
                <div class="bg-option" data-type="image" data-bg="nature1">
                    <div class="bg-thumb" style="background-image: url('https://images.unsplash.com/photo-1501854140801-50d01698950b?w=400&h=300&fit=crop')"></div>
                </div>
                <div class="bg-option" data-type="image" data-bg="nature2">
                    <div class="bg-thumb" style="background-image: url('https://images.unsplash.com/photo-1426604966848-d7adac402bff?w=400&h=300&fit=crop')"></div>
                </div>
                <div class="bg-option" data-type="image" data-bg="city1">
                    <div class="bg-thumb" style="background-image: url('https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?w=400&h=300&fit=crop')"></div>
                </div>
                <div class="bg-option" data-type="custom" data-bg="custom">
                    自定义
                </div>
            </div>
        </div>
        
        <div class="form-group hidden" id="customBgSection">
            <label>上传自定义背景</label>
            <input type="file" 
                   id="bgUploadInput" 
                   accept="image/*" 
                   style="margin-bottom: 12px;">
            <div class="bg-preview" id="bgPreview">
                <span>预览区域</span>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 12px;">
                <input type="color" 
                       id="bgColorPicker" 
                       value="#f8fafc"
                       style="width: 50px; height: 40px;">
                <input type="text" 
                       id="bgUrlInput" 
                       placeholder="或输入图片URL"
                       class="form-input"
                       style="flex: 1;">
            </div>
        </div>
        
        <div class="modal-actions">
            <button class="btn btn-secondary" id="cancelBgBtn">取消</button>
            <button class="btn btn-primary" id="applyBgBtn">应用背景</button>
        </div>
    </div>

    <!-- 名言管理面板 -->
    <div class="quotes-manager-panel" id="quotesManagerPanel">
        <div class="modal-header">
            <h3><i class="fas fa-quote-right"></i> 名言管理</h3>
            <button class="close-modal" id="closeQuotesPanel">&times;</button>
        </div>
        
        <div class="add-quote-section">
            <div class="form-group">
                <label for="newQuoteText">名言内容</label>
                <textarea class="form-textarea" 
                          id="newQuoteText" 
                          placeholder="输入名言内容..." 
                          rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="newQuoteAuthor">来源/作者</label>
                <input type="text" 
                       class="form-input" 
                       id="newQuoteAuthor" 
                       placeholder="例如：《肖申克的救赎》">
            </div>
            <button class="btn btn-success" id="addQuoteBtn">
                <i class="fas fa-plus"></i> 添加名言
            </button>
        </div>
        
        <div class="quotes-list" id="quotesList">
            <!-- 名言列表将通过JS动态生成 -->
        </div>
    </div>

    <!-- 任务详情模态框 -->
    <div class="modal" id="taskDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> 编辑任务</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="taskDetailForm">
                <div class="form-group">
                    <label for="editTaskTitle">任务名称</label>
                    <input type="text" id="editTaskTitle" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="editTaskCategory">分类</label>
                    <select id="editTaskCategory" class="form-select" required>
                        <option value="工作">工作</option>
                        <option value="学习">学习</option>
                        <option value="生活">生活</option>
                        <option value="健康">健康</option>
                        <option value="其他">其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editTaskDate">日期</label>
                    <input type="date" id="editTaskDate" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="editTaskPoints">积分</label>
                    <input type="number" id="editTaskPoints" class="form-input" min="1" max="10" value="5" required>
                </div>
                <div class="form-group">
                    <label for="editTaskNotes">备注</label>
                    <textarea id="editTaskNotes" class="form-textarea" rows="3" placeholder="任务备注..."></textarea>
                </div>
                <div class="form-group">
                    <div class="space-between">
                        <label>任务链接</label>
                        <button type="button" class="btn btn-sm btn-primary add-link-btn" id="addLinkBtn">
                            <i class="fas fa-plus"></i> 添加链接
                        </button>
                    </div>
                    <div class="links-container" id="linksContainer">
                        <!-- 链接将通过JS动态生成 -->
                    </div>
                </div>
                <input type="hidden" id="editTaskId">
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary cancel-btn">取消</button>
                    <button type="submit" class="btn btn-primary">保存任务</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ==================== 核心工具函数 ====================
        const Utils = {
            generateId: () => Date.now().toString(36) + Math.random().toString(36).substr(2),
            
            formatDate: (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            },
            
            getToday: () => Utils.formatDate(new Date()),
            
            debounce: (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },
            
            deepClone: (obj) => JSON.parse(JSON.stringify(obj)),
            
            isValidUrl: (string) => {
                try {
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            }
        };

        // ==================== 本地存储管理 ====================
        const Storage = {
            KEYS: {
                TASKS: 'daily_tasks',
                QUOTES: 'inspirational_quotes',
                SCORE_DATA: 'score_data',
                SCORE_RULES: 'score_rules',
                SEARCH_ENGINE: 'search_engine',
                PANEL_TRANSPARENCY: 'panel_transparency',
                BACKGROUND_SETTINGS: 'background_settings',
                PANEL_POSITIONS: 'panel_positions',
                ACTIVITIES: 'daily_activities' // 新增：存储每日活动
            },
            
            get: (key) => {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('读取存储失败:', e);
                    return null;
                }
            },
            
            set: (key, value) => {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (e) {
                    console.error('存储失败:', e);
                }
            },
            
            remove: (key) => {
                localStorage.removeItem(key);
            },
            
            clear: () => {
                localStorage.clear();
            }
        };

        // ==================== 背景系统 ====================
        const BackgroundSystem = {
            currentBg: null,
            
            init: () => {
                const savedBg = Storage.get(Storage.KEYS.BACKGROUND_SETTINGS);
                if (savedBg) {
                    BackgroundSystem.applyBackground(savedBg);
                    BackgroundSystem.currentBg = savedBg;
                }
                
                BackgroundSystem.bindEvents();
            },
            
            applyBackground: (bgSettings) => {
                const body = document.body;
                
                if (!bgSettings) {
                    body.className = '';
                    body.style.background = '';
                    body.style.backgroundImage = '';
                    return;
                }
                
                switch (bgSettings.type) {
                    case 'gradient':
                        const gradients = {
                            gradient1: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                            gradient2: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                            gradient3: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'
                        };
                        body.className = '';
                        body.style.background = gradients[bgSettings.value] || gradients.gradient1;
                        body.style.backgroundImage = '';
                        break;
                        
                    case 'color':
                        body.className = '';
                        body.style.background = bgSettings.value;
                        body.style.backgroundImage = '';
                        break;
                        
                    case 'image':
                        const images = {
                            nature1: 'https://images.unsplash.com/photo-1501854140801-50d01698950b?w=1920&q=80',
                            nature2: 'https://images.unsplash.com/photo-1426604966848-d7adac402bff?w=1920&q=80',
                            city1: 'https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?w=1920&q=80'
                        };
                        body.className = 'custom-bg';
                        body.style.backgroundImage = `url('${images[bgSettings.value] || images.nature1}')`;
                        break;
                        
                    case 'custom':
                        if (bgSettings.value.startsWith('#')) {
                            body.className = '';
                            body.style.background = bgSettings.value;
                            body.style.backgroundImage = '';
                        } else if (bgSettings.value.startsWith('http') || bgSettings.value.startsWith('data:')) {
                            body.className = 'custom-bg';
                            body.style.backgroundImage = `url('${bgSettings.value}')`;
                        }
                        break;
                }
                
                BackgroundSystem.currentBg = bgSettings;
                Storage.set(Storage.KEYS.BACKGROUND_SETTINGS, bgSettings);
            },
            
            bindEvents: () => {
                document.getElementById('bgSettingsBtn').addEventListener('click', () => {
                    BackgroundSystem.showBgSettingsPanel();
                });
                
                document.getElementById('closeBgPanel').addEventListener('click', () => {
                    document.getElementById('bgSettingsPanel').classList.remove('active');
                });
                
                document.getElementById('cancelBgBtn').addEventListener('click', () => {
                    document.getElementById('bgSettingsPanel').classList.remove('active');
                });
                
                document.querySelectorAll('.bg-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.bg-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        e.currentTarget.classList.add('selected');
                        
                        const type = e.currentTarget.dataset.type;
                        const customBgSection = document.getElementById('customBgSection');
                        if (type === 'custom') {
                            customBgSection.classList.remove('hidden');
                        } else {
                            customBgSection.classList.add('hidden');
                        }
                    });
                });
                
                const bgUploadInput = document.getElementById('bgUploadInput');
                if (bgUploadInput) {
                    bgUploadInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            if (!file.type.match('image.*')) {
                                alert('请选择图片文件！');
                                return;
                            }
                            
                            if (file.size > 5 * 1024 * 1024) {
                                alert('图片大小不能超过5MB！');
                                return;
                            }
                            
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const bgPreview = document.getElementById('bgPreview');
                                bgPreview.innerHTML = `<img src="${e.target.result}" alt="背景预览">`;
                                document.getElementById('bgUrlInput').value = e.target.result;
                                
                                document.querySelector('.bg-option[data-type="custom"]').click();
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
                
                document.getElementById('applyBgBtn').addEventListener('click', () => {
                    const selectedOption = document.querySelector('.bg-option.selected');
                    if (!selectedOption) return;
                    
                    const type = selectedOption.dataset.type;
                    const value = selectedOption.dataset.bg;
                    
                    if (type === 'custom') {
                        const bgUrl = document.getElementById('bgUrlInput').value.trim();
                        const bgColor = document.getElementById('bgColorPicker').value;
                        
                        if (bgUrl) {
                            if (bgUrl.startsWith('data:') || bgUrl.startsWith('http')) {
                                BackgroundSystem.applyBackground({
                                    type: 'custom',
                                    value: bgUrl
                                });
                            } else {
                                alert('请输入有效的图片URL或使用上传功能！');
                            }
                        } else if (bgColor) {
                            BackgroundSystem.applyBackground({
                                type: 'custom',
                                value: bgColor
                            });
                        }
                    } else {
                        BackgroundSystem.applyBackground({
                            type: type,
                            value: value
                        });
                    }
                    
                    document.getElementById('bgSettingsPanel').classList.remove('active');
                    bgUploadInput.value = '';
                });
                
                document.getElementById('bgSettingsPanel').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        document.getElementById('bgSettingsPanel').classList.remove('active');
                    }
                });
                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        document.getElementById('bgSettingsPanel').classList.remove('active');
                    }
                });
            },
            
            showBgSettingsPanel: () => {
                const bgPreview = document.getElementById('bgPreview');
                if (BackgroundSystem.currentBg) {
                    if (BackgroundSystem.currentBg.type === 'image' || 
                        (BackgroundSystem.currentBg.type === 'custom' && 
                         (BackgroundSystem.currentBg.value.startsWith('http') || 
                          BackgroundSystem.currentBg.value.startsWith('data:')))) {
                        bgPreview.innerHTML = `<img src="${BackgroundSystem.currentBg.value}" alt="当前背景">`;
                        document.getElementById('bgUrlInput').value = BackgroundSystem.currentBg.value;
                    }
                }
                
                document.getElementById('bgSettingsPanel').classList.add('active');
            }
        };

        // ==================== 搜索系统 ====================
        const SearchSystem = {
            engines: {
                bing: {
                    name: 'Bing',
                    url: 'https://www.bing.com/search',
                    param: 'q',
                    icon: 'fab fa-microsoft'
                },
                google: {
                    name: 'Google',
                    url: 'https://www.google.com/search',
                    param: 'q',
                    icon: 'fab fa-google'
                },
                baidu: {
                    name: '百度',
                    url: 'https://www.baidu.com/s',
                    param: 'wd',
                    icon: 'fab fa-baidu'
                },
                github: {
                    name: 'GitHub',
                    url: 'https://github.com/search',
                    param: 'q',
                    icon: 'fab fa-github'
                }
            },
            
            currentEngine: 'bing',
            
            init: () => {
                const savedEngine = Storage.get(Storage.KEYS.SEARCH_ENGINE);
                if (savedEngine && SearchSystem.engines[savedEngine]) {
                    SearchSystem.currentEngine = savedEngine;
                }
                
                SearchSystem.renderEngineOptions();
                SearchSystem.bindEvents();
            },
            
            renderEngineOptions: () => {
                const container = document.getElementById('searchEngineOptions');
                container.innerHTML = '';
                
                Object.entries(SearchSystem.engines).forEach(([key, engine]) => {
                    const option = document.createElement('div');
                    option.className = `search-engine-option ${key === SearchSystem.currentEngine ? 'selected' : ''}`;
                    option.dataset.engine = key;
                    option.innerHTML = `
                        <i class="${engine.icon}"></i> ${engine.name}
                    `;
                    container.appendChild(option);
                });
                
                const searchInput = document.getElementById('searchInput');
                searchInput.placeholder = `在${SearchSystem.engines[SearchSystem.currentEngine].name}中搜索...`;
                
                const searchForm = document.getElementById('searchForm');
                const engine = SearchSystem.engines[SearchSystem.currentEngine];
                searchForm.action = engine.url;
                
                const existingParams = searchForm.querySelectorAll('input[name]');
                existingParams.forEach(param => {
                    if (param.name !== 'q' && param.name !== engine.param) {
                        param.remove();
                    }
                });
                
                if (engine.param !== 'q') {
                    searchInput.name = engine.param;
                    const hiddenQ = document.createElement('input');
                    hiddenQ.type = 'hidden';
                    hiddenQ.name = 'q';
                    hiddenQ.value = '';
                    searchForm.appendChild(hiddenQ);
                }
            },
            
            bindEvents: () => {
                document.getElementById('searchEngineOptions').addEventListener('click', (e) => {
                    const option = e.target.closest('.search-engine-option');
                    if (option) {
                        SearchSystem.currentEngine = option.dataset.engine;
                        Storage.set(Storage.KEYS.SEARCH_ENGINE, SearchSystem.currentEngine);
                        SearchSystem.renderEngineOptions();
                    }
                });
                
                document.getElementById('searchForm').addEventListener('submit', (e) => {
                    const input = document.getElementById('searchInput');
                    if (!input.value.trim()) {
                        e.preventDefault();
                        return;
                    }
                });
                
                document.addEventListener('keydown', (e) => {
                    if (e.key === '/' && document.activeElement !== document.getElementById('searchInput')) {
                        e.preventDefault();
                        document.getElementById('searchInput').focus();
                    }
                });
            }
        };

        // ==================== 名言系统 ====================
        const QuoteSystem = {
            quotes: [],
            currentIndex: 0,
            autoRotateInterval: null,
            
            init: () => {
                QuoteSystem.loadQuotes();
                QuoteSystem.renderCurrentQuote();
                QuoteSystem.bindEvents();
                QuoteSystem.startAutoRotate();
            },
            
            loadQuotes: () => {
                const savedQuotes = Storage.get(Storage.KEYS.QUOTES);
                if (savedQuotes && savedQuotes.length > 0) {
                    QuoteSystem.quotes = savedQuotes;
                } else {
                    QuoteSystem.quotes = [
                        { text: "生活就像一盒巧克力，你永远不知道下一颗是什么味道。", author: "《阿甘正传》" },
                        { text: "希望是美好的，也许是人间至善，而美好的事物永不消逝。", author: "《肖申克的救赎》" },
                        { text: "要么忙着活，要么忙着死。", author: "《肖申克的救赎》" },
                        { text: "重要的不是发生了什么，而是你如何应对。", author: "《风雨哈佛路》" },
                        { text: "不要等待机会，而要创造机会。", author: "乔治·伯纳德·肖" },
                        { text: "成功的秘诀在于对目标的坚持不懈。", author: "本杰明·迪斯雷利" },
                        { text: "今天能做的事，绝不要留到明天。", author: "本杰明·富兰克林" },
                        { text: "你的时间有限，不要为别人而活。", author: "史蒂夫·乔布斯" }
                    ];
                    Storage.set(Storage.KEYS.QUOTES, QuoteSystem.quotes);
                }
            },
            
            renderCurrentQuote: () => {
                const quote = QuoteSystem.quotes[QuoteSystem.currentIndex];
                if (quote) {
                    document.getElementById('currentQuote').textContent = quote.text;
                    document.getElementById('quoteAuthor').textContent = quote.author;
                }
            },
            
            nextQuote: () => {
                QuoteSystem.currentIndex = (QuoteSystem.currentIndex + 1) % QuoteSystem.quotes.length;
                QuoteSystem.renderCurrentQuote();
            },
            
            prevQuote: () => {
                QuoteSystem.currentIndex = (QuoteSystem.currentIndex - 1 + QuoteSystem.quotes.length) % QuoteSystem.quotes.length;
                QuoteSystem.renderCurrentQuote();
            },
            
            addQuote: (text, author) => {
                if (!text.trim()) return;
                
                const newQuote = {
                    text: text.trim(),
                    author: author.trim() || "未知"
                };
                
                QuoteSystem.quotes.push(newQuote);
                Storage.set(Storage.KEYS.QUOTES, QuoteSystem.quotes);
                QuoteSystem.renderQuotesList();
                
                return newQuote;
            },
            
            deleteQuote: (index) => {
                if (index >= 0 && index < QuoteSystem.quotes.length) {
                    QuoteSystem.quotes.splice(index, 1);
                    Storage.set(Storage.KEYS.QUOTES, QuoteSystem.quotes);
                    
                    if (QuoteSystem.currentIndex >= QuoteSystem.quotes.length) {
                        QuoteSystem.currentIndex = Math.max(0, QuoteSystem.quotes.length - 1);
                    }
                    
                    QuoteSystem.renderCurrentQuote();
                    QuoteSystem.renderQuotesList();
                }
            },
            
            renderQuotesList: () => {
                const container = document.getElementById('quotesList');
                container.innerHTML = '';
                
                QuoteSystem.quotes.forEach((quote, index) => {
                    const quoteItem = document.createElement('div');
                    quoteItem.className = 'quote-item';
                    quoteItem.innerHTML = `
                        <div class="quote-item-content">
                            <div class="quote-item-text">${quote.text}</div>
                            <div class="quote-item-source">—— ${quote.author}</div>
                        </div>
                        <div class="quote-item-actions">
                            <button class="btn btn-danger btn-sm" data-index="${index}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    container.appendChild(quoteItem);
                });
                
                container.querySelectorAll('.btn-danger').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.index);
                        if (confirm('确定要删除这条名言吗？')) {
                            QuoteSystem.deleteQuote(index);
                        }
                    });
                });
            },
            
            startAutoRotate: () => {
                if (QuoteSystem.autoRotateInterval) {
                    clearInterval(QuoteSystem.autoRotateInterval);
                }
                
                QuoteSystem.autoRotateInterval = setInterval(() => {
                    QuoteSystem.nextQuote();
                }, 30000);
            },
            
            bindEvents: () => {
                document.getElementById('prevQuoteBtn').addEventListener('click', () => {
                    QuoteSystem.prevQuote();
                });
                
                document.getElementById('nextQuoteBtn').addEventListener('click', () => {
                    QuoteSystem.nextQuote();
                });
                
                document.getElementById('manageQuotesBtn').addEventListener('click', () => {
                    QuoteSystem.renderQuotesList();
                    document.getElementById('quotesManagerPanel').classList.add('active');
                });
                
                document.getElementById('closeQuotesPanel').addEventListener('click', () => {
                    document.getElementById('quotesManagerPanel').classList.remove('active');
                });
                
                document.getElementById('addQuoteBtn').addEventListener('click', () => {
                    const text = document.getElementById('newQuoteText').value;
                    const author = document.getElementById('newQuoteAuthor').value;
                    
                    if (text.trim()) {
                        QuoteSystem.addQuote(text, author);
                        document.getElementById('newQuoteText').value = '';
                        document.getElementById('newQuoteAuthor').value = '';
                        
                        QuoteSystem.currentIndex = QuoteSystem.quotes.length - 1;
                        QuoteSystem.renderCurrentQuote();
                    }
                });
                
                document.getElementById('quotesManagerPanel').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        document.getElementById('quotesManagerPanel').classList.remove('active');
                    }
                });
                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        document.getElementById('quotesManagerPanel').classList.remove('active');
                    }
                });
            }
        };

        // ==================== 积分统计系统 - 简化版 ====================
        const ScoreSystem = {
            activities: [],
            scoreRules: {
                // 加分项
                运动: 3, 跑步: 3, 健身: 3, 锻炼: 3,
                学习: 2, 读书: 2, 阅读: 2, 课程: 2,
                工作: 2, 项目: 2, 完成: 2, 任务: 2,
                早起: 2, 早睡: 2, 睡眠: 1,
                冥想: 2, 瑜伽: 2,
                健康饮食: 2, 做饭: 1,
                整理: 1, 清洁: 1,
                
                // 扣分项
                熬夜: -3, 晚睡: -2, 通宵: -4,
                拖延: -2, 懒惰: -1,
                垃圾食品: -2, 外卖: -1, 油炸: -1,
                久坐: -1, 不动: -1,
                发脾气: -2, 生气: -1,
                浪费: -1, 乱花钱: -1
            },
            
            init: () => {
                ScoreSystem.loadActivities();
                ScoreSystem.renderStats();
                ScoreSystem.renderSuggestions();
                ScoreSystem.bindEvents();
            },
            
            loadActivities: () => {
                const savedActivities = Storage.get(Storage.KEYS.ACTIVITIES);
                if (savedActivities) {
                    ScoreSystem.activities = savedActivities;
                }
            },
            
            calculateScore: (activityText) => {
                let score = 0;
                const text = activityText.toLowerCase();
                
                // 检查每个规则
                Object.entries(ScoreSystem.scoreRules).forEach(([keyword, value]) => {
                    if (text.includes(keyword.toLowerCase())) {
                        score += value;
                    }
                });
                
                // 如果没有匹配到规则，默认给1分（鼓励记录）
                if (score === 0) {
                    score = 1;
                }
                
                // 限制分数在-5到5之间
                return Math.max(-5, Math.min(5, score));
            },
            
            addActivity: (activityText) => {
                if (!activityText.trim()) return null;
                
                const score = ScoreSystem.calculateScore(activityText);
                const newActivity = {
                    id: Utils.generateId(),
                    text: activityText.trim(),
                    score: score,
                    timestamp: new Date().toISOString(),
                    date: Utils.getToday()
                };
                
                ScoreSystem.activities.unshift(newActivity);
                Storage.set(Storage.KEYS.ACTIVITIES, ScoreSystem.activities);
                ScoreSystem.renderStats();
                
                return newActivity;
            },
            
            clearTodayActivities: () => {
                const today = Utils.getToday();
                ScoreSystem.activities = ScoreSystem.activities.filter(activity => activity.date !== today);
                Storage.set(Storage.KEYS.ACTIVITIES, ScoreSystem.activities);
                ScoreSystem.renderStats();
            },
            
            renderStats: () => {
                const today = Utils.getToday();
                const todayActivities = ScoreSystem.activities.filter(activity => activity.date === today);
                
                let totalScore = 0;
                let positiveScore = 0;
                let negativeScore = 0;
                
                todayActivities.forEach(activity => {
                    totalScore += activity.score;
                    if (activity.score > 0) {
                        positiveScore += activity.score;
                    } else {
                        negativeScore += activity.score;
                    }
                });
                
                document.getElementById('totalScore').textContent = `${totalScore} 分`;
                document.getElementById('todayPositive').textContent = `${positiveScore} 分`;
                document.getElementById('todayNegative').textContent = `${negativeScore} 分`;
                
                // 计算累计积分（所有日期的总和）
                let accumulated = 0;
                ScoreSystem.activities.forEach(activity => {
                    accumulated += activity.score;
                });
                document.getElementById('totalAccumulated').textContent = `${accumulated} 分`;
                
                // 更新任务统计
                const tasks = Storage.get(Storage.KEYS.TASKS) || [];
                const completedToday = tasks.filter(task => 
                    task.completed && task.date === today
                ).length;
                document.getElementById('completedTasksScore').textContent = `${completedToday} 个`;
            },
            
            renderSuggestions: () => {
                const container = document.getElementById('activitySuggestions');
                container.innerHTML = '';
                
                const suggestions = [
                    '跑步30分钟', '健身1小时', '瑜伽20分钟',
                    '阅读1小时', '学习新技能', '完成工作项目',
                    '早起(7点前)', '早睡(11点前)', '冥想15分钟',
                    '健康饮食', '自己做饭', '整理房间',
                    '完成今日任务', '写日记', '学习英语'
                ];
                
                suggestions.forEach(suggestion => {
                    const btn = document.createElement('button');
                    btn.className = 'suggestion-btn';
                    btn.textContent = suggestion;
                    btn.title = `点击添加: ${suggestion}`;
                    btn.addEventListener('click', () => {
                        document.getElementById('activityInput').value = suggestion;
                        document.getElementById('activityInput').focus();
                    });
                    container.appendChild(btn);
                });
            },
            
            bindEvents: () => {
                document.getElementById('addActivityBtn').addEventListener('click', () => {
                    const input = document.getElementById('activityInput');
                    const activityText = input.value.trim();
                    
                    if (activityText) {
                        const activity = ScoreSystem.addActivity(activityText);
                        if (activity) {
                            input.value = '';
                            const scoreText = activity.score > 0 ? `+${activity.score}分` : `${activity.score}分`;
                            alert(`已记录: "${activity.text}" (${scoreText})`);
                        }
                    } else {
                        alert('请输入活动内容！');
                    }
                });
                
                document.getElementById('clearActivitiesBtn').addEventListener('click', () => {
                    if (confirm('确定要清空今日的所有活动记录吗？')) {
                        ScoreSystem.clearTodayActivities();
                        alert('今日活动记录已清空！');
                    }
                });
                
                document.getElementById('quickAddTaskBtn').addEventListener('click', () => {
                    const input = document.getElementById('activityInput');
                    const activityText = input.value.trim();
                    
                    if (activityText) {
                        document.getElementById('taskTitle').value = activityText;
                        document.getElementById('taskCategory').value = this.guessCategory(activityText);
                        document.getElementById('taskDate').value = Utils.getToday();
                        document.getElementById('taskPoints').value = 5;
                        
                        document.getElementById('taskTitle').focus();
                        input.value = '';
                        
                        alert('已填充到任务表单，请完善其他信息后添加任务！');
                    }
                });
                
                // 按Enter键快速添加活动
                document.getElementById('activityInput').addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        document.getElementById('addActivityBtn').click();
                    }
                });
            },
            
            guessCategory: (text) => {
                const lowerText = text.toLowerCase();
                if (lowerText.includes('工作') || lowerText.includes('项目') || lowerText.includes('报告')) {
                    return '工作';
                } else if (lowerText.includes('学习') || lowerText.includes('读书') || lowerText.includes('阅读')) {
                    return '学习';
                } else if (lowerText.includes('运动') || lowerText.includes('跑步') || lowerText.includes('健身')) {
                    return '健康';
                } else if (lowerText.includes('整理') || lowerText.includes('清洁') || lowerText.includes('购物')) {
                    return '生活';
                } else {
                    return '其他';
                }
            }
        };

        // ==================== 任务管理系统 ====================
        const TaskSystem = {
            tasks: [],
            draggingTask: null,
            dragOverTask: null,
            
            init: () => {
                TaskSystem.loadTasks();
                TaskSystem.renderTasks();
                TaskSystem.bindEvents();
                TaskSystem.updateTaskStats();
                TaskSystem.initDragAndDrop();
            },
            
            loadTasks: () => {
                const savedTasks = Storage.get(Storage.KEYS.TASKS);
                if (savedTasks) {
                    TaskSystem.tasks = savedTasks;
                }
            },
            
            renderTasks: () => {
                const container = document.getElementById('taskList');
                container.innerHTML = '';
                
                if (TaskSystem.tasks.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-tasks"></i>
                            <p>暂无任务</p>
                        </div>
                    `;
                    return;
                }
                
                TaskSystem.tasks.forEach((task, index) => {
                    const taskItem = TaskSystem.createTaskElement(task, index);
                    container.appendChild(taskItem);
                });
            },
            
            createTaskElement: (task, index) => {
                const element = document.createElement('div');
                element.className = 'task-item';
                element.dataset.id = task.id;
                element.dataset.index = index;
                element.draggable = true;
                
                let linksHtml = '';
                if (task.links && task.links.length > 0) {
                    linksHtml = `<div class="task-links">`;
                    task.links.forEach(link => {
                        linksHtml += `
                            <a href="${link.url}" class="task-link" target="_blank">
                                <i class="fas fa-link"></i>
                                <span>${link.name}</span>
                            </a>
                        `;
                    });
                    linksHtml += `</div>`;
                }
                
                element.innerHTML = `
                    <div class="task-header">
                        <div class="task-drag-handle">
                            <i class="fas fa-grip-vertical"></i>
                        </div>
                        <div class="task-checkbox">
                            <input type="checkbox" ${task.completed ? 'checked' : ''} data-id="${task.id}">
                        </div>
                        <div class="task-content">
                            <div class="task-title ${task.completed ? 'completed' : ''}">${task.title}</div>
                            ${task.notes ? `<div class="task-notes">${task.notes}</div>` : ''}
                            <div class="task-meta">
                                <span class="task-category">${task.category}</span>
                                <span class="task-date">${task.date}</span>
                                <span class="task-points">+${task.points}积分</span>
                            </div>
                            ${linksHtml}
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-sm btn-primary edit-task-btn" data-id="${task.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm ${task.completed ? 'btn-warning' : 'btn-success'} toggle-task-btn" data-id="${task.id}">
                                <i class="fas ${task.completed ? 'fa-undo' : 'fa-check'}"></i>
                            </button>
                            <button class="btn btn-sm btn-danger delete-task-btn" data-id="${task.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                return element;
            },
            
            addTask: (taskData) => {
                const newTask = {
                    id: Utils.generateId(),
                    completed: false,
                    createdAt: new Date().toISOString(),
                    ...taskData
                };
                
                TaskSystem.tasks.unshift(newTask);
                Storage.set(Storage.KEYS.TASKS, TaskSystem.tasks);
                TaskSystem.renderTasks();
                TaskSystem.updateTaskStats();
                
                return newTask;
            },
            
            updateTask: (taskId, taskData) => {
                const taskIndex = TaskSystem.tasks.findIndex(task => task.id === taskId);
                if (taskIndex !== -1) {
                    TaskSystem.tasks[taskIndex] = {
                        ...TaskSystem.tasks[taskIndex],
                        ...taskData
                    };
                    Storage.set(Storage.KEYS.TASKS, TaskSystem.tasks);
                    TaskSystem.renderTasks();
                    TaskSystem.updateTaskStats();
                    return true;
                }
                return false;
            },
            
            toggleTaskComplete: (taskId) => {
                const taskIndex = TaskSystem.tasks.findIndex(task => task.id === taskId);
                if (taskIndex !== -1) {
                    TaskSystem.tasks[taskIndex].completed = !TaskSystem.tasks[taskIndex].completed;
                    Storage.set(Storage.KEYS.TASKS, TaskSystem.tasks);
                    
                    if (TaskSystem.tasks[taskIndex].completed) {
                        const task = TaskSystem.tasks[taskIndex];
                        ScoreSystem.addActivity(`完成任务：${task.title}`);
                    }
                    
                    TaskSystem.renderTasks();
                    TaskSystem.updateTaskStats();
                }
            },
            
            deleteTask: (taskId) => {
                if (confirm('确定要删除这个任务吗？')) {
                    TaskSystem.tasks = TaskSystem.tasks.filter(task => task.id !== taskId);
                    Storage.set(Storage.KEYS.TASKS, TaskSystem.tasks);
                    TaskSystem.renderTasks();
                    TaskSystem.updateTaskStats();
                }
            },
            
            getTaskById: (taskId) => {
                return TaskSystem.tasks.find(task => task.id === taskId);
            },
            
            updateTaskStats: () => {
                const total = TaskSystem.tasks.length;
                const completed = TaskSystem.tasks.filter(task => task.completed).length;
                const pending = total - completed;
                const today = Utils.getToday();
                
                const todayExp = TaskSystem.tasks.reduce((sum, task) => {
                    if (task.completed && task.date === today) {
                        return sum + (parseInt(task.points) || 0);
                    }
                    return sum;
                }, 0);
                
                document.getElementById('totalTasks').textContent = total;
                document.getElementById('completedTasks').textContent = completed;
                document.getElementById('pendingTasks').textContent = pending;
                document.getElementById('todayExp').textContent = todayExp;
                
                const expPercent = Math.min(100, (todayExp / 100) * 100);
                document.getElementById('expBar').style.width = `${expPercent}%`;
            },
            
            initDragAndDrop: () => {
                const taskList = document.getElementById('taskList');
                
                taskList.addEventListener('dragstart', (e) => {
                    const taskItem = e.target.closest('.task-item');
                    if (taskItem) {
                        TaskSystem.draggingTask = taskItem;
                        taskItem.classList.add('dragging');
                        e.dataTransfer.setData('text/plain', taskItem.dataset.id);
                    }
                });
                
                taskList.addEventListener('dragend', (e) => {
                    const taskItem = e.target.closest('.task-item');
                    if (taskItem) {
                        taskItem.classList.remove('dragging');
                        TaskSystem.draggingTask = null;
                        TaskSystem.dragOverTask = null;
                        
                        document.querySelectorAll('.task-item.drag-over').forEach(item => {
                            item.classList.remove('drag-over');
                        });
                    }
                });
                
                taskList.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const taskItem = e.target.closest('.task-item');
                    if (taskItem && taskItem !== TaskSystem.draggingTask) {
                        if (TaskSystem.dragOverTask !== taskItem) {
                            if (TaskSystem.dragOverTask) {
                                TaskSystem.dragOverTask.classList.remove('drag-over');
                            }
                            taskItem.classList.add('drag-over');
                            TaskSystem.dragOverTask = taskItem;
                        }
                    }
                });
                
                taskList.addEventListener('dragleave', (e) => {
                    const taskItem = e.target.closest('.task-item');
                    if (taskItem && taskItem === TaskSystem.dragOverTask) {
                        if (!taskItem.contains(e.relatedTarget)) {
                            taskItem.classList.remove('drag-over');
                            TaskSystem.dragOverTask = null;
                        }
                    }
                });
                
                taskList.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const dropTarget = e.target.closest('.task-item');
                    if (dropTarget && TaskSystem.draggingTask) {
                        dropTarget.classList.remove('drag-over');
                        
                        const draggingId = TaskSystem.draggingTask.dataset.id;
                        const droppingId = dropTarget.dataset.id;
                        
                        const draggingIndex = TaskSystem.tasks.findIndex(task => task.id === draggingId);
                        const droppingIndex = TaskSystem.tasks.findIndex(task => task.id === droppingId);
                        
                        if (draggingIndex !== -1 && droppingIndex !== -1) {
                            const [draggedTask] = TaskSystem.tasks.splice(draggingIndex, 1);
                            TaskSystem.tasks.splice(droppingIndex, 0, draggedTask);
                            
                            Storage.set(Storage.KEYS.TASKS, TaskSystem.tasks);
                            TaskSystem.renderTasks();
                        }
                    }
                });
            },
            
            showEditTaskModal: (taskId) => {
                const task = TaskSystem.getTaskById(taskId);
                if (!task) return;
                
                document.getElementById('editTaskId').value = taskId;
                document.getElementById('editTaskTitle').value = task.title;
                document.getElementById('editTaskCategory').value = task.category;
                document.getElementById('editTaskDate').value = task.date;
                document.getElementById('editTaskPoints').value = task.points;
                document.getElementById('editTaskNotes').value = task.notes || '';
                
                const linksContainer = document.getElementById('linksContainer');
                linksContainer.innerHTML = '';
                
                if (task.links && task.links.length > 0) {
                    task.links.forEach((link, index) => {
                        TaskSystem.addLinkField(link.name, link.url, index);
                    });
                } else {
                    TaskSystem.addLinkField('', '', 0);
                }
                
                document.getElementById('taskDetailModal').classList.add('active');
            },
            
            addLinkField: (name = '', url = '', index = 0) => {
                const linksContainer = document.getElementById('linksContainer');
                const linkItem = document.createElement('div');
                linkItem.className = 'link-item';
                linkItem.innerHTML = `
                    <input type="text" 
                           class="form-input link-name" 
                           placeholder="链接名称" 
                           value="${name}">
                    <input type="url" 
                           class="form-input link-url" 
                           placeholder="https://example.com" 
                           value="${url}">
                    <button type="button" class="btn btn-danger btn-sm remove-link-btn" ${index === 0 ? 'disabled' : ''}>
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                linksContainer.appendChild(linkItem);
            },
            
            bindEvents: () => {
                const addTaskForm = document.getElementById('addTaskForm');
                if (addTaskForm) {
                    addTaskForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        
                        const taskData = {
                            title: document.getElementById('taskTitle').value.trim(),
                            category: document.getElementById('taskCategory').value,
                            date: document.getElementById('taskDate').value,
                            points: parseInt(document.getElementById('taskPoints').value) || 5,
                            notes: document.getElementById('taskNotes').value.trim()
                        };
                        
                        if (taskData.title && taskData.category && taskData.date) {
                            TaskSystem.addTask(taskData);
                            addTaskForm.reset();
                            document.getElementById('taskDate').value = Utils.getToday();
                            document.getElementById('taskPoints').value = 5;
                        }
                    });
                }
                
                document.getElementById('taskList').addEventListener('click', (e) => {
                    const taskId = e.target.closest('[data-id]')?.dataset.id;
                    if (!taskId) return;
                    
                    if (e.target.closest('.toggle-task-btn')) {
                        TaskSystem.toggleTaskComplete(taskId);
                    }
                    
                    if (e.target.closest('.delete-task-btn')) {
                        TaskSystem.deleteTask(taskId);
                    }
                    
                    if (e.target.closest('.edit-task-btn')) {
                        TaskSystem.showEditTaskModal(taskId);
                    }
                });
                
                document.getElementById('taskList').addEventListener('change', (e) => {
                    if (e.target.type === 'checkbox') {
                        const taskId = e.target.dataset.id;
                        TaskSystem.toggleTaskComplete(taskId);
                    }
                });
                
                document.getElementById('addLinkBtn').addEventListener('click', () => {
                    const linksContainer = document.getElementById('linksContainer');
                    const linkCount = linksContainer.children.length;
                    TaskSystem.addLinkField('', '', linkCount);
                });
                
                document.getElementById('linksContainer').addEventListener('click', (e) => {
                    if (e.target.closest('.remove-link-btn') && !e.target.closest('.remove-link-btn').disabled) {
                        e.target.closest('.link-item').remove();
                    }
                });
                
                const taskDetailForm = document.getElementById('taskDetailForm');
                if (taskDetailForm) {
                    taskDetailForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        
                        const taskId = document.getElementById('editTaskId').value;
                        const links = [];
                        
                        document.querySelectorAll('.link-item').forEach(item => {
                            const name = item.querySelector('.link-name').value.trim();
                            const url = item.querySelector('.link-url').value.trim();
                            if (name && url) {
                                links.push({ name, url });
                            }
                        });
                        
                        const taskData = {
                            title: document.getElementById('editTaskTitle').value.trim(),
                            category: document.getElementById('editTaskCategory').value,
                            date: document.getElementById('editTaskDate').value,
                            points: parseInt(document.getElementById('editTaskPoints').value) || 5,
                            notes: document.getElementById('editTaskNotes').value.trim(),
                            links: links
                        };
                        
                        if (taskData.title && taskData.category && taskData.date) {
                            TaskSystem.updateTask(taskId, taskData);
                            document.getElementById('taskDetailModal').classList.remove('active');
                        }
                    });
                }
                
                document.querySelectorAll('#taskDetailModal .close-modal, #taskDetailModal .cancel-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.getElementById('taskDetailModal').classList.remove('active');
                    });
                });
                
                document.getElementById('taskDetailModal').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        document.getElementById('taskDetailModal').classList.remove('active');
                    }
                });
            }
        };

        // ==================== 拖拽系统 - 优化版 ====================
        const DragSystem = {
            draggingPanel: null,
            dragOffsetX: 0,
            dragOffsetY: 0,
            panels: {},
            
            init: () => {
                // 定义可拖拽的面板
                DragSystem.panels = {
                    searchBox: document.getElementById('searchBox'),
                    quoteBox: document.getElementById('quoteBox'),
                    scorePanel: document.getElementById('scorePanel'),
                    statusPanel: document.getElementById('statusPanel'),
                    taskPanel: document.getElementById('taskPanel'),
                    transparencyPanel: document.getElementById('transparencyPanel')
                };
                
                // 加载保存的面板位置
                DragSystem.loadPanelPositions();
                
                // 为每个面板添加拖拽功能（只通过拖拽手柄）
                Object.entries(DragSystem.panels).forEach(([key, panel]) => {
                    if (panel) {
                        DragSystem.makeDraggable(panel, key);
                    }
                });
                
                // 保存布局按钮
                document.getElementById('saveLayoutBtn').addEventListener('click', () => {
                    DragSystem.saveLayout();
                    
                    // 显示保存成功的提示
                    const btn = document.getElementById('saveLayoutBtn');
                    const originalHtml = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    btn.style.background = '#68D391';
                    
                    setTimeout(() => {
                        btn.innerHTML = originalHtml;
                        btn.style.background = '';
                    }, 1000);
                });
            },
            
            makeDraggable: (panel, panelId) => {
                // 找到拖拽手柄
                const dragHandle = panel.querySelector('.drag-handle');
                if (!dragHandle) return;
                
                // 鼠标按下开始拖拽
                dragHandle.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    DragSystem.startDrag(e, panel, panelId);
                });
                
                // 触摸屏支持
                dragHandle.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    DragSystem.startDrag({
                        clientX: touch.clientX,
                        clientY: touch.clientY,
                        target: e.target
                    }, panel, panelId);
                });
            },
            
            startDrag: (e, panel, panelId) => {
                DragSystem.draggingPanel = panel;
                panel.classList.add('dragging');
                
                // 计算鼠标/触摸点相对于面板左上角的偏移
                const rect = panel.getBoundingClientRect();
                DragSystem.dragOffsetX = e.clientX - rect.left;
                DragSystem.dragOffsetY = e.clientY - rect.top;
                
                // 设置面板为绝对定位，并提高z-index
                panel.style.position = 'absolute';
                panel.style.zIndex = '1000';
                panel.style.cursor = 'grabbing';
                
                // 移动面板
                document.addEventListener('mousemove', DragSystem.onDragMove);
                document.addEventListener('touchmove', DragSystem.onDragMoveTouch, { passive: false });
                
                // 停止拖拽
                document.addEventListener('mouseup', DragSystem.stopDrag);
                document.addEventListener('touchend', DragSystem.stopDrag);
            },
            
            onDragMove: (e) => {
                if (!DragSystem.draggingPanel) return;
                
                e.preventDefault();
                DragSystem.movePanel(e.clientX, e.clientY);
            },
            
            onDragMoveTouch: (e) => {
                if (!DragSystem.draggingPanel) return;
                
                e.preventDefault();
                const touch = e.touches[0];
                DragSystem.movePanel(touch.clientX, touch.clientY);
            },
            
            movePanel: (clientX, clientY) => {
                const panel = DragSystem.draggingPanel;
                if (!panel) return;
                
                // 计算新位置
                let x = clientX - DragSystem.dragOffsetX;
                let y = clientY - DragSystem.dragOffsetY;
                
                // 获取视口尺寸和面板尺寸
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                const panelWidth = panel.offsetWidth;
                const panelHeight = panel.offsetHeight;
                
                // 设置边界限制（保留10px边距）
                const minX = 10;
                const maxX = viewportWidth - panelWidth - 10;
                const minY = 10;
                const maxY = viewportHeight - panelHeight - 10;
                
                // 检查是否超出边界
                let isOutOfBoundary = false;
                
                if (x < minX) {
                    x = minX;
                    isOutOfBoundary = true;
                } else if (x > maxX) {
                    x = maxX;
                    isOutOfBoundary = true;
                }
                
                if (y < minY) {
                    y = minY;
                    isOutOfBoundary = true;
                } else if (y > maxY) {
                    y = maxY;
                    isOutOfBoundary = true;
                }
                
                // 应用位置
                panel.style.left = `${x}px`;
                panel.style.top = `${y}px`;
                
                // 如果超出边界，添加提示效果
                if (isOutOfBoundary && !panel.classList.contains('boundary-limit')) {
                    panel.classList.add('boundary-limit');
                    setTimeout(() => {
                        panel.classList.remove('boundary-limit');
                    }, 500);
                }
            },
            
            stopDrag: () => {
                if (!DragSystem.draggingPanel) return;
                
                const panel = DragSystem.draggingPanel;
                panel.classList.remove('dragging');
                panel.classList.remove('boundary-limit');
                panel.style.cursor = '';
                DragSystem.draggingPanel = null;
                
                // 移除事件监听器
                document.removeEventListener('mousemove', DragSystem.onDragMove);
                document.removeEventListener('touchmove', DragSystem.onDragMoveTouch);
                document.removeEventListener('mouseup', DragSystem.stopDrag);
                document.removeEventListener('touchend', DragSystem.stopDrag);
                
                // 保存当前位置
                DragSystem.savePanelPositions();
            },
            
            savePanelPositions: () => {
                const positions = {};
                
                Object.entries(DragSystem.panels).forEach(([key, panel]) => {
                    if (panel && panel.style.position === 'absolute') {
                        positions[key] = {
                            left: panel.style.left,
                            top: panel.style.top,
                            width: panel.offsetWidth
                        };
                    }
                });
                
                Storage.set(Storage.KEYS.PANEL_POSITIONS, positions);
            },
            
            loadPanelPositions: () => {
                const positions = Storage.get(Storage.KEYS.PANEL_POSITIONS);
                if (!positions) return;
                
                Object.entries(positions).forEach(([key, pos]) => {
                    const panel = DragSystem.panels[key];
                    if (panel && pos.left && pos.top) {
                        panel.style.position = 'absolute';
                        panel.style.left = pos.left;
                        panel.style.top = pos.top;
                        panel.style.zIndex = '10';
                        
                        // 检查位置是否在可视区域内
                        const rect = panel.getBoundingClientRect();
                        const viewportWidth = window.innerWidth;
                        const viewportHeight = window.innerHeight;
                        
                        if (rect.left < 0 || rect.top < 0 || 
                            rect.right > viewportWidth || rect.bottom > viewportHeight) {
                            // 如果面板在可视区域外，重置位置
                            panel.style.position = '';
                            panel.style.left = '';
                            panel.style.top = '';
                        }
                    }
                });
            },
            
            saveLayout: () => {
                DragSystem.savePanelPositions();
            },
            
            resetLayout: () => {
                if (confirm('确定要重置所有面板位置吗？')) {
                    Object.entries(DragSystem.panels).forEach(([key, panel]) => {
                        if (panel) {
                            panel.style.position = '';
                            panel.style.left = '';
                            panel.style.top = '';
                            panel.style.zIndex = '';
                        }
                    });
                    
                    Storage.remove(Storage.KEYS.PANEL_POSITIONS);
                    alert('布局已重置！');
                }
            }
        };

        // ==================== 透明度控制系统 ====================
        const TransparencySystem = {
            init: () => {
                const savedTransparency = Storage.get(Storage.KEYS.PANEL_TRANSPARENCY);
                const slider = document.getElementById('panelTransparency');
                const valueDisplay = document.getElementById('transparencyValue');
                
                if (savedTransparency) {
                    slider.value = savedTransparency;
                }
                
                TransparencySystem.updateTransparency(slider.value);
                valueDisplay.textContent = `${slider.value}%`;
                
                slider.addEventListener('input', (e) => {
                    const value = e.target.value;
                    TransparencySystem.updateTransparency(value);
                    valueDisplay.textContent = `${value}%`;
                });
                
                slider.addEventListener('change', (e) => {
                    Storage.set(Storage.KEYS.PANEL_TRANSPARENCY, e.target.value);
                });
            },
            
            updateTransparency: (value) => {
                const panels = document.querySelectorAll('.panel, .search-box, .quote-box, .score-panel');
                const opacity = value / 100;
                
                panels.forEach(panel => {
                    const currentBg = window.getComputedStyle(panel).background;
                    const newBg = currentBg.replace(/rgba?\([^)]+\)/, `rgba(255, 255, 255, ${opacity})`);
                    panel.style.background = newBg;
                });
            }
        };

        // ==================== 数据导入导出系统 ====================
        const DataSystem = {
            exportAllData: () => {
                const data = {
                    tasks: Storage.get(Storage.KEYS.TASKS) || [],
                    quotes: Storage.get(Storage.KEYS.QUOTES) || [],
                    activities: Storage.get(Storage.KEYS.ACTIVITIES) || [],
                    backgroundSettings: Storage.get(Storage.KEYS.BACKGROUND_SETTINGS) || null,
                    panelPositions: Storage.get(Storage.KEYS.PANEL_POSITIONS) || {},
                    exportDate: new Date().toISOString(),
                    version: '2.0'
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `daily-tasks-backup-${Utils.formatDate(new Date())}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            },
            
            importData: (jsonData) => {
                try {
                    const data = typeof jsonData === 'string' ? JSON.parse(jsonData) : jsonData;
                    
                    if (data.tasks) Storage.set(Storage.KEYS.TASKS, data.tasks);
                    if (data.quotes) Storage.set(Storage.KEYS.QUOTES, data.quotes);
                    if (data.activities) Storage.set(Storage.KEYS.ACTIVITIES, data.activities);
                    if (data.backgroundSettings) Storage.set(Storage.KEYS.BACKGROUND_SETTINGS, data.backgroundSettings);
                    if (data.panelPositions) Storage.set(Storage.KEYS.PANEL_POSITIONS, data.panelPositions);
                    
                    return { success: true, message: '数据导入成功！' };
                } catch (error) {
                    return { success: false, message: `导入失败：${error.message}` };
                }
            },
            
            resetAll: () => {
                if (confirm('确定要重置所有数据吗？此操作将清除所有任务、名言、活动数据和面板布局，且不可撤销！')) {
                    // 只清除数据，不清除背景设置
                    const bgSettings = Storage.get(Storage.KEYS.BACKGROUND_SETTINGS);
                    Storage.clear();
                    
                    if (bgSettings) {
                        Storage.set(Storage.KEYS.BACKGROUND_SETTINGS, bgSettings);
                    }
                    
                    location.reload();
                }
            },
            
            bindEvents: () => {
                document.getElementById('exportDataBtn').addEventListener('click', () => {
                    DataSystem.exportAllData();
                });
                
                document.getElementById('importDataBtn').addEventListener('click', () => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = 'application/json';
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const result = DataSystem.importData(e.target.result);
                                if (result.success) {
                                    alert(result.message);
                                    location.reload();
                                } else {
                                    alert(result.message);
                                }
                            };
                            reader.readAsText(file);
                        }
                    };
                    input.click();
                });
                
                document.getElementById('resetAllBtn').addEventListener('click', () => {
                    DataSystem.resetAll();
                });
            }
        };

        // ==================== 应用初始化 ====================
        const App = {
            init: () => {
                // 设置默认日期
                document.getElementById('taskDate').value = Utils.getToday();
                
                // 初始化所有系统
                BackgroundSystem.init();
                SearchSystem.init();
                QuoteSystem.init();
                ScoreSystem.init();
                TaskSystem.init();
                TransparencySystem.init();
                DragSystem.init();
                DataSystem.bindEvents();
                
                // 添加键盘快捷键
                App.addKeyboardShortcuts();
                
                console.log('应用初始化完成！');
            },
            
            addKeyboardShortcuts: () => {
                document.addEventListener('keydown', (e) => {
                    // Ctrl/Cmd + S 保存布局
                    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                        e.preventDefault();
                        document.getElementById('saveLayoutBtn').click();
                    }
                    
                    // Ctrl/Cmd + E 导出数据
                    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                        e.preventDefault();
                        document.getElementById('exportDataBtn').click();
                    }
                    
                    // Ctrl/Cmd + R 重置布局
                    if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                        e.preventDefault();
                        DragSystem.resetLayout();
                    }
                });
            }
        };

        // 页面加载完成后初始化应用
        document.addEventListener('DOMContentLoaded', App.init);
    </script>
</body>
</html>